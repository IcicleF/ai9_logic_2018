# 2018年智能体大赛 逻辑参考文档

**阅读提示：本文档仅供已经了解游戏规则，并希望编写AI的选手参考。如果您只是希望了解本游戏，请关闭本文档，出门右转，以免对本游戏丧失兴趣。**

## 前言

欢迎您参加2018年智能体大赛。如果您阅读到此处，想必您已经做好编写AI并参赛的准备。为了您的方便，我们向您提供这份逻辑参考文档；理论上，有关游戏逻辑的所有问题都能通过本文档得到解决。

如您仍有疑问没有得到解答，或者认为本文档中有明显的错误，抑或是认为逻辑的运作方式明显不合理，欢迎您在智能体大赛QQ群中提出，或者联系<a href="mailto:icicle.flw@gmail.com">icicle.flw@gmail.com</a>。我们将尽快给出回复。

## 游戏流程

本节介绍游戏从开始到结束逻辑的运作流程。本节内的某些名词无法详尽解释，请参阅后面的章节以查看严格的定义。

### 地图

游戏进行在一张二维的矩形地图上。地图上有若干障碍物，玩家的行动会被障碍物阻挡。

每个障碍物实际上是地图上的一个矩形区域，区域的四边平行于地图的四边。

* 把每个障碍物对应的矩形区域的四边分别外推 0.05，形成一个长、宽分别增加 0.10 的矩形；这个矩形才是实际的不可达区域。
* 不可达区域内部的位置称为**非法位置**，反之则称为**合法位置**。区域的边界均是合法位置。

在逻辑内部，所有的实数均使用 `float` 类型存储，包括坐标。

但是，视野范围和道具使用则不受障碍物阻挡。

* 作为一种直观的理解，在编写AI时，您可以认为地图上有若干矩形的水池，而玩家并不能踏浪而行。
* 虽说到了真正的游戏界面中，障碍物并非水池而是建筑，不过这不影响您的理解。

### 初始化

游戏开始时，所有参与游戏的玩家和 10 个村民在地图上的**随机位置**出生。

**随机位置**定义为地图上一个随机的合法位置。逻辑选取随机位置的方法是：

* 随机选取 x、y 坐标，如果该点是一个非法位置，那么重新选取 x、y 坐标，直到得到一个合法位置；
* 上述随机选取的 x、y 坐标分别满足对应坐标范围内（即地图范围内）的一个均匀分布。

### 回合结算

每一回合，在所有玩家报告本回合的行动之后，由游戏主循环触发回合结算。结算过程如下：

1. 行动阶段
	* 存活的村民报告本回合的行动；
2. 非伤害结算阶段
	* 过期的守卫从地图上消失；
	* 所有玩家（不论是否死亡）金钱自然增长；
3. 伤害结算阶段
	* 炸弹：到达爆炸时间的炸弹爆炸，从地图上消失，所有波及到的单位受到伤害；
	* 灼烧：如果是白天，则活着的玩家受到灼烧伤害；
	* 普通攻击：目标受到伤害，攻击的施放者回复体力；
	* **在这个阶段，单位是不会死亡的；即便某位玩家受到的伤害量致死，如果她使用普通攻击，那么普通攻击的效果仍然结算，甚至可能将她“救活”；**
4. 死亡结算阶段
	* 受到致死伤害量的单位死亡；
	* 死亡的玩家受到死亡惩罚，参与击杀单位的玩家得到击杀奖励；
	* 如果一个玩家在同一回合内参与击杀单位并且死亡，那么先进行死亡惩罚，再结算击杀奖励，最后清零连杀记录；
5. 道具购买阶段
	* 根据玩家的指令购买道具。
6. 道具使用阶段
	* 玩家向指定的地点投出炸弹；
	* 玩家在指定的地点放置守卫；
7. 移动计算阶段
	* 根据玩家的指令移动；
8. 重生阶段
	* 死亡惩罚结束的玩家在随机位置复活；
	* 村民以 0.025 的概率在随机位置出生；如果成功出生一位村民，那么重复上述过程，否则停止重生村民。
		* 0.025 概率的产生方式如下：生成一个服从 [-1, 39) 的均匀分布的随机实数，小于 0 则成功；

### 胜利判定

在有至少一位玩家的积分达到 20 分或以上，或者回合数达到 3000 时，将会产生胜利者。

产生胜利者的过程是：将所有玩家排名，排第一者获胜。排名标准如下：

* 积分高者获胜；
* 积分相同，金钱多者获胜；
* 积分和金钱相同，总击杀数少者获胜；
* 积分、金钱和总击杀数相同，击杀村民数少着获胜。
* 积分、金钱、总击杀数、击杀村民数全部相同，**胜者随机**。

产生胜利者时，游戏即告结束。

## 玩家和村民

所有单位的初始生命值均为 100，**单位**即玩家和村民的统称。每个单位之间没有外观上的区别，亦即，您无法通过逻辑提供的数据直接得知视野内单位的具体身份。当然，通过严谨的观察识别出谁是无害的 NPC，而谁又是您的敌人，正是本游戏的卖点。

玩家和村民拥有一些共同的属性，这些属性包括：

* **HP**：即生命值，HP 降至 0 或以下，单位即告死亡；
* **位置**：单位当前所在的位置，以二维实数坐标表示；
* **速度**：单位的速度向量，模或者为 0，或者为 0.6。

另外一些属性是玩家独有的：

* **金钱**：玩家持有的资源，次要胜负判定条件，亦可用来交换道具；
* **积分**：主要胜负判定条件；
* **道具数目**：炸弹和守卫的持有数；
* **冷却时间**：炸弹、守卫，以及普通攻击的冷却时间；
* **连杀数**：在上一次重生后，连续击杀的敌人数目；连杀数越多，下次击杀得分越高；
* **击杀数**：击杀的村民和敌人数目，次要胜负判定条件。

请务必注意，在我们为您提供的视野中不包含冷却时间信息。您只能得知当前是否能使用某一道具或普通攻击。

另外，玩家每 10 回合还将获得 1 金钱。金钱的自然增长与玩家是否死亡无关。

## 移动

游戏中单位可以移动。如上所述，移动在回合最后、单位重生之前结算。

所有的移动都是分段的匀速直线运动，移动速度只能是每回合 0.6 单位长度。虽然这么说，因为是回合制，所以实质上都是“瞬移”。

玩家通过选择一个目标地点来进行移动。寻路组件在二维实数地图上通过 Dijkstra 算法计算一条最短路，之后就沿着这条最短路向终点前进。中途即使玩家不再发出指令，逻辑也会使玩家按照已经找好的路径移动至先前选取的终点。

* 如果玩家希望停下，需要主动发出选择当前位置为终点的一个移动命令。

村民的移动规律如下：任意选取地图上一个合法位置，沿最短路径前往彼处，原地停止 20 ~ 50 回合，然后重复。不过，在村民重生后的第一次移动之前，有 1/2 的概率先原地静止不动 1 ~ 15 回合，再开始第一次移动。

## 昼夜和视野系统

如您所知，游戏中存在昼夜系统。良好利用昼夜的特性，在白天隐藏自己、收集信息，在黑夜亮出獠牙，是取胜的关键。

* 白昼长度为 200 回合，黑夜长度为 150 回合；
* 游戏开始时为白昼的第一回合，白昼结束后立即转入黑夜，黑夜过后则立即转入白昼，如此往复。

昼夜变化影响玩家自身的视野，方式如下：

* 在白昼，玩家的视野范围为 50；
* 在黑夜，玩家的视野范围为 20；

另外，守卫也可以为放置它的玩家提供视野。守卫提供的视野与昼夜无关，始终为 15。如果玩家死亡，在死亡惩罚期间内，玩家丧失自身的视野，但玩家放置的守卫则照常提供视野。

以下的对象将显现在玩家的视野范围内：

* 其他单位
* 尚未消失的尸体
* 飞行中的炸弹
* 玩家自己放置的守卫

需要您注意的是，为了逻辑运作和您编写程序的方便，我们会为您视野内的所有单位分配一个编号，这个编号实际上就是从 1 开始递增的自然数列。每当一个新的单位进入您的视野，它就会得到一个新的编号。注意，一个先离开又重新进入您视野的单位，在重新进入时**仍将得到新的编号**，您无从得知它是否曾经进入过您的视野。

玩家自身的信息（HP、位置、速度、分数、道具数量、金钱），以及全局计分板是始终可见的，这部分信息也将作为视野的一部分提供给您。

除此之外，如果是在白昼，玩家还将持续受到灼烧伤害，方式如下：

* 每 30 回合，受到 9 点伤害。**所谓“每30回合”，是指玩家在编号为 30 的倍数，同时又是白昼的回合受到伤害（首回合的编号为 1）。**

## 道具系统

如您所知，游戏提供两种道具供您购买：炸弹，以及守卫。炸弹可以造成一个大额的范围伤害，守卫则可以监视一个固定地点提供视野。

持有和使用道具会给您带来很多便利，不过无限制地购买道具也并非合理的策略（参见：游戏流程/胜利判定，第 2 条）。如何购买和使用道具全凭您的选择。

炸弹的特点如下：

* 使用炸弹不受地形影响，炸弹可以正常地投向任何一个位置并在那里爆炸，爆炸同样不受地形阻拦；
* 炸弹从投出到爆炸有一个延迟，该延迟的长度为 3 回合；这期间，炸弹作匀速直线运动由投出点飞向起爆点；
* 炸弹的爆炸伤害为 90 点，爆炸半径为 10，受波及的单位无论与爆炸中心的距离，均受到等同的伤害。

**请注意，投出的炸弹有可能被其他玩家所看到；其他玩家将能看到炸弹的位置（飞行中）和速度，但不能得知它何时爆炸。**

守卫的特点如下：

* 使用守卫不受地形影响，守卫可以正常地放置在离玩家距离不超过 10 的任何一个位置，提供的视野范围不受地形阻拦；
* 守卫放置后立刻生效并且不能再移动，监视以其自身为圆心、半径 30 的一个圆 150 回合，之后消失。

炸弹和守卫的价格分别为 20 和 5 金钱。可以随时购买道具，但每种道具在使用后都将会进入冷却。炸弹的冷却时间为 40 回合，守卫的冷却时间则为 200 回合。

* 这意味着，任何时候，您最多在地图上放置一个守卫。

## 奖惩

击杀任何其他单位都获得奖励，自身被击杀则受到死亡惩罚。

奖励分为两种：分数和金钱。击杀任何单位都能获得金钱，但只有击杀敌人时才能获得分数。

由于玩家获得各自的视野是在回合结算之前，且每回合仅这一次机会获得视野，您无法直接得知您是否击杀了某个单位；同样的，您也无法直接得知您击杀的是敌人还是普通的村民。不过，由于我们提供计分板信息，因此您可以通过下一回合您分数和金钱的变化推断击杀情况；当然，视野内出现的尸体也是一个很好的判断基准。

击杀单位时获得的奖励如下：

* 被击杀单位是村民，获得 6 金钱；
* 被击杀单位是玩家，获得 15 金钱，连杀数加 1，然后获得等于当前连杀数的分数。

死亡惩罚如下：

* 80 回合内处于死亡状态，一切指令无效，并且如上所述，丧失自身的视野；
* 所持金钱乘以 0.7 向下取整。

如果一个单位在同一回合内受到多个来源的伤害而死亡，那么无论伤害大小，所有造成了伤害的玩家均得到完整的奖励。例如，如果两位其他玩家 A、B 扔出的炸弹同时击中了 HP 为 1 的玩家 C（共造成 180 伤害），那么 C 死亡，A、B 均得到 15 金钱，连杀数和分数也各自累加。

请注意，单位若死亡，则仅当前回合对该单位造成了伤害的玩家算作击杀者。即，任何形式的助攻均不被考虑。

## 总结

通过以上的描述，您应该已经对逻辑的运作方式有了充分的了解。

如果您希望继续了解如何编写 AI，请移步 SDK 参考文档。

感谢您的阅读，祝您参赛愉快。
