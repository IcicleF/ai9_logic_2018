<script type="text/javascript" asyncr o
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

#2018年智能体大赛 逻辑参考文档

**阅读提示：本文档仅供已经了解游戏规则，并希望编写AI的选手参考。如果您只是希望了解本游戏，请关闭本文档，出门右转，以免对本游戏丧失兴趣。**

##前言

欢迎您参加2018年智能体大赛。如果您阅读到此处，想必您已经做好编写AI并参赛的准备。为了您的方便，我们向您提供这份逻辑参考文档；理论上，有关游戏逻辑的所有问题都能通过本文档得到解决。

如您仍有疑问没有得到解答，或者认为本文档中有明显的错误，抑或是认为逻辑的运作方式明显不合理，欢迎您在智能体大赛QQ群中提出，或者联系<a href="mailto:icicle.flw@gmail.com">icicle.flw@gmail.com</a>。我们将尽快给出回复。

##游戏流程

本节介绍游戏从开始到结束逻辑的运作流程。本节内的某些名词无法详尽解释，请参阅后面的章节以查看严格的定义。

###地图

游戏进行在一张二维的矩形地图上。地图上有若干障碍物，玩家的行动会被障碍物阻挡。

每个障碍物实际上是地图上的一个矩形区域，区域的四边平行于地图的四边。

* 把每个障碍物对应的矩形区域的四边分别外推 $0.05$ 单位，形成一个长、宽分别增加 $0.10$ 单位的矩形；这个矩形才是实际的不可达区域。
* 不可达区域内部的位置称为**非法位置**，反之则称为**合法位置**。区域的边界均是合法位置。

在逻辑内部，所有的实数均使用 `float` 类型存储，任何的坐标亦然。

但是，视野范围和道具使用则不受障碍物阻挡。

* 作为一种直观的理解，在编写AI时，您可以认为地图上有若干矩形的水池，而玩家并不能踏浪而行。
* 虽说到了真正的游戏界面中，障碍物并非水池而是建筑，不过这不影响您的理解。

###初始化

游戏开始时，所有参与游戏的玩家和 $10$ 个村民在地图上的**随机位置**出生。

**随机位置**定义为地图上一个随机的合法位置：逻辑选取随机位置的方法是：

* 随机选取x、y坐标，如果该点是一个非法位置，那么重新选取x、y坐标，直到得到一个合法位置；
* 上述随机选取的x、y坐标分别满足对应坐标范围内的一个均匀分布；
* 上述均匀分布使用C++ 11标准模板库 `random` 提供的 `std::uniform_real_distribution<float>` 实现；
* 生成随机数时，`std::uniform_real_distribution<float>` 使用的URNG随机数核心，是同样由C++ 11标准模板库提供的 `std::mt19937`；
* `mt19937` 即马赛斯特旋转演算法（Mersenne Twister），是一种优秀的伪随机数发生器；该伪随机数发生器随逻辑初始化而初始化，使用的随机种子决定于服务器端当时的系统时间，即 `std::chrono::system_clock::now().time_since_epoch().count()`。

上述 `mt19937` 随机数核心也用于逻辑中其他需要生成随机数的场合，详见下面的说明。

###回合结算

每一回合，在所有玩家报告本回合的行动之后，由游戏主循环触发回合结算。结算过程如下：

1. 行动阶段
	* 存活的村民报告本回合的行动；
2. 守卫结算阶段
	* 过期的守卫从地图上消失；
3. 伤害结算阶段
	* 炸弹：到达爆炸时间的炸弹爆炸，从地图上消失，所有波及到的单位收到伤害；
	* 灼烧：如果是白天，则活着的玩家受到灼烧伤害；
	* 普通攻击：目标受到伤害，攻击的施放者回复体力；
	* **在这个阶段，单位是不会死亡的；即便某位玩家受到的伤害量致死，如果她使用普通攻击，那么普通攻击的效果仍然结算，甚至可能将她“救活”；**
4. 死亡结算阶段
	* 受到致死伤害量的单位死亡；
	* 死亡的玩家受到死亡惩罚，参与击杀单位的玩家得到击杀奖励，助攻则不被考虑；
	* 参与击杀的玩家都将得到一份完整的击杀奖励（分数或金钱），而不是所有人分配一份奖励；
	* 如果一个玩家在同一回合内参与击杀单位并且死亡，那么先进行死亡惩罚，再结算击杀奖励，最后清零连杀记录；
5. 道具使用阶段
	* 玩家向指定的地点投出炸弹；如果未持有炸弹，或者炸弹仍在冷却时间内，或者玩家已经死亡，那么指令无效；
	* 玩家在指定的地点放置守卫；如果未持有守卫，或者炸弹仍在冷却时间内，或者玩家已经死亡，那么指令无效；
6. 移动计算阶段
	* 根据玩家的指令移动；如果玩家已经死亡，那么指令无效；
7. 重生阶段
	* 死亡惩罚结束的玩家在随机位置复活；
	* 村民以 $1/16$ 的概率在随机位置出生；如果成功出生一位村民，那么重复上述过程，否则停止重生村民。
		* $1/16$ 概率的产生方式如下：使用一个 `std::uniform_real_distribution<float>` 生成服从 $[-1, 15)$ 的均匀分布的随机实数，小于 $0$ 则成功；
8. 道具购买阶段
	* 根据玩家的指令购买道具；如果金钱不足，那么指令无效。

###胜利判定

在有至少一位玩家的积分达到 $30$ 分或以上，或者回合数达到 $2000$ 时，将会产生胜利者。

产生胜利者的过程是：将所有玩家排名，排第一者获胜。排名标准如下：

* 积分高者获胜；
* 积分相同，金钱多者获胜；
* 积分和金钱相同，总击杀数少者获胜；
* 积分、金钱和总击杀数相同，击杀村民数少着获胜。
* 积分、金钱、总击杀数、击杀村民数全部相同，**胜者随机**。

产生胜利者时，游戏即告结束。

##昼夜和视野系统

如您所知，游戏中存在昼夜。

* 昼夜变化和 DotA、DOTA 2 等 MOBA 游戏相同，没有过渡期。